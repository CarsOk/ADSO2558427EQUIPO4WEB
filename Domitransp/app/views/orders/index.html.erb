<div class="ibox-content m-b-sm border-bottom">
  <div class="row">
    <div class="col-sm-6">
      <%= form_tag(orders_path, method: :get, class: "form-group") do %>
        <label class="col-form-label">Consecutivo:</label>
        <%= text_field_tag :consecutivo, params[:consecutivo], class: "form-control" %>
        <label class="col-form-label">Desde:</label>
        <%= date_field_tag :fecha_desde, params[:fecha_desde], class: "form-control" %>
        <label class="col-form-label">Hasta:</label>
        <%= date_field_tag :fecha_hasta, params[:fecha_hasta], class: "form-control" %>
        <%= submit_tag "Buscar", class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox">
        <div class="ibox-title">
          <h5>Envíos</h5>
          <div class="ibox-tools">
            <a class="collapse-link">
              <i class="fa fa-chevron-up"></i>
            </a>
            <a href="<%= orders_path(format: 'pdf', consecutivo: params[:consecutivo], fecha_desde: params[:fecha_desde], fecha_hasta: params[:fecha_hasta]) %>" class="btn btn-link">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-pdf" viewBox="0 0 16 16">
                <path d="M6.293 1.293a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-3 3a1 1 0 0 1-1.414-1.414L8.586 7 6.293 4.707a1 1 0 0 1 0-1.414zM5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V1z"/>
                <path fill-rule="evenodd" d="M10.5 0a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5z"/>
              </svg> PDF
            </a>
            <a href="<%= export_to_excel_orders_path(format: 'xlsx', consecutivo: @consecutivo || '', fecha_desde: @fecha_desde || '', fecha_hasta: @fecha_hasta || '') %>" class="btn btn-link">              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-excel" viewBox="0 0 16 16">
                <path d="M6 0a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5z"/>
                <path fill-rule="evenodd" d="M7.293 1.293a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-1.5 1.5a1 1 0 0 1-1.414 0l-1.5-1.5a1 1 0 0 1 0-1.414l3-3zM7 0a1 1 0 0 1 1 1v4a1 1 0 0 1-2 0V1a1 1 0 0 1 1-1z"/>
                <path fill-rule="evenodd" d="M.5 8a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5zM1 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5zM.5 13a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z"/>
                <path d="M4 10h1v4H4v-4z"/>
                <path fill-rule="evenodd" d="M8 8a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5zM8 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5zM8 13a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5z"/>
                <path fill-rule="evenodd" d="M11.5 0a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5z"/>
              </svg> Excel
            </a>
          </div>
        </div>
        <div class="ibox-content">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Consecutivo</th>
                <th>Descripción</th>
                <th>Cantidad</th>
                <th>Origen</th>
                <th>Destino</th>
              </tr>
            </thead>
            <tbody>
              <% if @orders.present? %>
                <% @orders.each do |order| %>
                  <tr>
                    <td>
                      <div id="celda-anidados">
                        <p id="datos-envios"><%= order.fecha %></p>
                      </div>
                    </td>
                    <td id="celda-anidados">
                      <p id="datos-envios"><%= order.consecutivo %></p>
                    </td>
                    <td id="celda-anidados">
                      <% order.packs.each_with_index do |pack, index| %>
                        <% if index == order.packs.length - 1 %>
                          <p id="dato-anidado-ultimo"><%= pack.tipo %></p>
                        <% else %>
                          <p id="dato-anidado"><%= pack.tipo %></p>
                        <% end %>
                      <% end %>
                    </td>
                    <td id="celda-anidados">
                      <% order.packs.each_with_index do |pack, index| %>
                        <% if index == order.packs.length - 1 %>
                          <p id="dato-anidado-ultimo"><%= pack.cantidad %></p>
                        <% else %>
                          <p id="dato-anidado"><%= pack.cantidad %></p>
                        <% end %>
                      <% end %>
                    </td>
                    <td>
                      <p id="datos-envios"><%= order.origen %></p>
                    </td>
                    <td>
                      <p id="datos-envios"><%= order.destino %></p>
                    </td>
                  </tr>
                <% end %>
              <% else %>
                <tr>
                  <td colspan="6">No se encontraron resultados para "<%= params[:consecutivo] %>."</td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>